{% extends "base.html" %}

{% block content %}
<style>
    .channel-header {
        padding: 12px 10px 6px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #fff;
    }
    .channel-title {
        font-size: 18px;
        font-weight: 700;
    }
    .video-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        padding: 10px;
    }
    .video-card {
        background: #1e1e1e;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
    }
    .video-card img {
        width: 100%;
        aspect-ratio: 16 / 9;
        object-fit: cover;
        background: #000;
        display: block;
    }
    .video-card .info {
        padding: 10px;
    }
    .video-card .title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.3;
    }
    .video-card .uploader {
        font-size: 12px;
        color: #aaa;
    }
    @media (max-width: 600px) {
        .video-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
    }
</style>

<div class="channel-header">
    <div class="channel-title">{{ channel_name or '頻道' }}</div>
    <a href="/" style="color:#3ea6ff; font-size:13px;">回到首頁</a>
</div>

<div id="channel-grid" class="video-grid"></div>
<div id="channel-loading" style="text-align:center; padding:20px; color:#777;">載入中...</div>
<div id="channel-empty" style="text-align:center; padding:20px; color:#777; display:none;">沒有影片</div>

<script>
    const channelId = "{{ channel_id }}";
    const channelName = "{{ channel_name }}";

    async function loadChannelVideos() {
        const grid = document.getElementById('channel-grid');
        const loading = document.getElementById('channel-loading');
        const empty = document.getElementById('channel-empty');
        try {
            const res = await fetch(`/api/channel_videos?channelId=${encodeURIComponent(channelId)}`);
            const data = await res.json();
            loading.style.display = 'none';
            if (!data.videos || data.videos.length === 0) {
                empty.style.display = 'block';
                return;
            }
            data.videos.forEach(video => {
                const div = document.createElement('div');
                div.className = 'video-card';
                div.setAttribute('data-vid', video.id);
                div.setAttribute('data-channel', video.channel_id || channelId);
                div.onclick = function () { openPlayer(video); };
                div.innerHTML = `
                    <img src="${video.thumbnail}" loading="lazy">
                    <div class="info">
                        <div class="title">${video.title}</div>
                        <div class="uploader">${video.uploader || channelName}</div>
                    </div>
                `;
                grid.appendChild(div);
            });
        } catch (e) {
            loading.innerText = '載入失敗';
            console.error(e);
        }
    }

    window.onload = loadChannelVideos;
</script>
{% endblock %}
